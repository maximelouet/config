#!/bin/sh

# Saumon i3blocks scripts : INTERNET
# (wired/wifi network info with external ip on middle click)

ifaceWIFI=$(echo /sys/class/net/*/wireless | awk -F '/' '{ print $5 }')
ifaceETH=$(echo /sys/class/net/en*/ | awk -F '/' '{ print $5 }')

case $BLOCK_BUTTON in
    2) IP=$(curl -s "ifconfig.me/ip" | tr -d '\n'); notify-send "External IP address" $IP; echo -n $IP | xclip -i -selection clipboard ;;
    3) IP=$(ip addr show "$ifaceWIFI" | awk '/inet / {print $2}' | cut -d '/' -f1 | tr -d '\n'); notify-send "IP address" $IP; echo -n $IP | xclip -i -selection clipboard ;;
esac

statusWIFI=$(cat -- "$(readlink -e -- /sys/class/net/$ifaceWIFI/operstate)")

if [ -n "$ifaceETH" ] && [ "$ifaceETH" != "en*" ]; then
  statusETH=$(cat -- "$(readlink -e -- /sys/class/net/$ifaceETH/operstate)")
else
  statusETH="unknown"
fi

if [ "$statusETH" = "up" ]; then
   echo -n '<span color="#19ef5d"><b></b>  '
   ip addr show "$ifaceETH" | awk '/inet / {print $2}' | cut -d '/' -f1 | tr -d '\n'
   echo -n '</span>'
elif [ "$statusWIFI" = "up" ]; then
    IPaddr=$(ip addr show "$ifaceWIFI" | awk '/inet / {print $2}' | cut -d '/' -f1 | tr -d '\n')
    NetName=$(iwgetid -r | tr -d '\n')
    if [ "$IPaddr" = "" ]; then
        echo -n "<span color='#fa8026'>  (no IP)</span>"
    else
        echo -n "<span color='#19ef5d'>  "
        case "$IPaddr" in
            192.168.*) echo -n "${IPaddr#'192.168.'}" ;;
            10.41.*) echo -n "<span font_size='small'>10.41.</span>${IPaddr#'10.41.'}" ;;
            *) echo -n "$IPaddr" ;;
        esac
        echo -n "</span> <span font_size='small'>on</span> $NetName"
    fi
else
    echo -n "<span color='#fa3826' font-weight='bold'>INTERNET ?</span>"
fi
